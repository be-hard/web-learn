### 为什么通常在第一次访问一个站点时，打开速度很慢，当再次访问这个站点时，速度就很快了？
主要是第一次加载页面过程中，缓存了一些耗时的数据。DNS 缓存和页面资源缓存这两块数据是会被浏览器缓存的。
在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。其中，浏览器缓存是一种在本地保存资源副本，以供下次请求时直接使用的技术。当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。

如果缓存查找失败，就会进入网络请求过程了。

### 浏览器缓存的实现
当服务器返回 HTTP 响应头给浏览器时，浏览器是通过响应头中的 Cache-Control 字段来设置是否缓存该资源。
缓存分为强制缓存和协商缓存
#### 强制缓存
强制缓存就是文件直接从缓存中获取，不需要发送请求.

强制缓存在 http1.0 的时候用的是 Expires，是响应头里面的一个字段表示的是文件过期时间。是一个绝对时间，正因为是绝对时间所以在某些情况下，服务器的时区和浏览器时区不一致的时候就会导致缓存失效。为了解决这个问题，HTPP1.1 引入了一个新的响应头 cache-control。
它的可选值如下
cache-control：
max-age: 缓存过期时间，是一个相对时间
public: 表示客户端和代理服务器都会缓存
private: 表示只在客户端缓存
no-cache: 协商缓存标识符，表示文件会被缓存但是需要和服务器协商
no-store: 表示文件不会被缓存


在该缓存资源还未过期的情况下, 如果再次请求该资源，会直接返回缓存中的资源给浏览器，并返回200。但如果缓存过期了，浏览器则会走协商缓存，继续发起网络请求，并且在 HTTP 请求头中带上：If-None-Match:"4f80f-13c-3a1xb12a"；
服务器收到请求头后，会根据 If-None-Match 的值来判断请求的资源是否有更新。如果没有更新，就返回 304 状态码，相当于服务器告诉浏览器：“这个缓存可以继续使用，这次就不重复发送数据给你了。”如果资源有更新，服务器就直接返回最新资源给浏览器。并且刷新资源的新鲜度。
![](https://static001.geekbang.org/resource/image/5f/08/5fc2f88a04ee0fc41a808f3481287408.png)

#### 协商缓存
协商缓存是利用 Last-Modified/if-Modified-Since和Etag/if-None-Match 这两对请求、响应头。
#### Last-Modified/if-Modified-Since
记录的是文件被改动的时间。
- 浏览器第一次发送请求获取文件缓存下来，服务器响应头返回一个 if-Modified-Since，记录被改动的时间
- 浏览器第二次发送请求的时候会带上一个 Last-Modified 请求头，时间就是 if-Modified-Since 返回的值。然后服务器拿到这个字段和自己内部设置的时间进行对比，时间相同表示没有修改，就直接返回 304 从缓存里面获取文件。资源更新了则返回200，返回新资源。
由于 Last-Modified 的时间粒度是秒，有的文件在 1s 内可能被改动多次。这种方式在这种特殊情况下还是会失效，
#### Etag/if-None-Match
所以HTTP1.1又引入了 Etag 字段。这个字段是根据文件内容生成一个标记符比如"W/"5f9583bd-10a8""，然后再和 If-None-Match 进行对比就能更准确的知道文件有没有被改动过。

etag优先级高于last-modified。从精确度来说，etag更加精确，E-tag是对文件求MD5或者哈希值，绝对精确，但etag值需要计算，同时，如果只是打开文件，并没有修改文件，也可能导致etag值改变。

### 缓存存放的位置
#### form memory cache
缓存在内存里面，优点是快速，但是具有时效性，当关闭 tab 时候缓存就会失效。
#### from dist cache
缓存在磁盘里面，虽然慢但是还是比请求快，优点是缓存可以一直被保留，即使关闭 tab 页，也会一直存在
一般来说：
大一点的文件会缓存在dist里面，因为内存也是有限的，磁盘的空间更大
小一点文件js,图片存的是memory
css文件一般存在dist
特殊情况memory大小是有限制的，浏览器也会根据自己的内置算法，把一部分js文件存到dist里面
### 浏览器缓存的好处
- 缓解服务器端压力，提升性能（获取资源的耗时更短了）
- 对于网站来说，缓存是实现快速资源加载的重要组成部分

### 状态码
信息响应(100–199)，成功响应(200–299)，重定向(300–399)，客户端错误(400–499)和服务器错误 (500–599)。

200：成功相应
301：永久重定向
302：临时重定向
304：协商缓存，资源未被修改
307：临时重定向，307 状态码可以确保请求方法和消息主体不会发生变化。
403：禁止访问
404：资源未被找到
405：请求的方式不对
502：错误响应